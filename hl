#!/usr/bin/env python3
import sys
import os
import json
import subprocess
import importlib.util
from datetime import datetime
from pathlib import Path

BASE_DIR = os.path.dirname(os.path.abspath(__file__))
TOOLS_DIR = os.path.join(BASE_DIR, "tools")
CONFIG_DIR = os.path.expanduser("~/.hacklab")
CONFIG_FILE = os.path.join(CONFIG_DIR, "config.json")
PROGRESS_FILE = os.path.join(CONFIG_DIR, "progress.json")

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
class Colors:
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    RED = '\033[91m'
    BLUE = '\033[94m'
    MAGENTA = '\033[95m'
    CYAN = '\033[96m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'
    END = '\033[0m'

def load_config():
    if not os.path.exists(CONFIG_FILE):
        return {"mode": "beginner", "level": 1, "xp": 0, "unlocked_tools": []}
    with open(CONFIG_FILE, "r") as f:
        return json.load(f)

def save_config(data):
    os.makedirs(CONFIG_DIR, exist_ok=True)
    with open(CONFIG_FILE, "w") as f:
        json.dump(data, f, indent=2)

def check_level_up(config):
    if config.get("mode") != "beginner":
        return config
    
    xp_needed = [0, 100, 250, 500, 850, 1300, 1850, 2500, 3250, 4100]
    level = config.get("level", 1)
    xp = config.get("xp", 0)
    
    while level < 10 and xp >= xp_needed[level]:
        level += 1
        print(f"\n{Colors.GREEN}üéâ –£–†–û–í–ï–ù–¨ –ü–û–í–´–®–ï–ù: {level-1} ‚Üí {level}!{Colors.END}")
        
        level_names = {
            1: "ü•ö Egg", 2: "üê£ Chick", 3: "üê• Chicken",
            4: "ü¶Ö Eagle", 5: "ü¶â Owl", 6: "üê∫ Wolf",
            7: "üêâ Dragon", 8: "üßô Wizard", 9: "üëë King",
            10: "üèÜ Legend"
        }
        
        if level in level_names:
            print(f"{Colors.YELLOW}üèÜ –ù–æ–≤—ã–π —Ç–∏—Ç—É–ª: {level_names[level]}{Colors.END}")
        
        tools_unlocked = {
            1: ["network_info", "port_check"],
            2: ["web_scanner"],
            3: ["ssl_checker"],
            4: ["whois_checker"],
            5: ["dir_buster"],
            6: ["subdomain_scanner"],
            7: ["cve_lookup"],
            8: ["hash_cracker"],
            9: ["sql_tester"],
            10: ["xss_scanner", "api_fuzzer"]
        }
        
        if level in tools_unlocked:
            unlocked = config.get("unlocked_tools", [])
            for tool in tools_unlocked[level]:
                if tool not in unlocked:
                    unlocked.append(tool)
            config["unlocked_tools"] = unlocked
            
            print(f"{Colors.CYAN}üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:{Colors.END}")
            for tool in tools_unlocked[level]:
                tool_name = tool.replace("_", " ").title()
                print(f"   ‚Ä¢ {tool_name}")
        
        if level == 10:
            print(f"\n{Colors.MAGENTA}üöÄ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –£–†–û–í–ù–Ø 10!{Colors.END}")
            print(f"{Colors.BLUE}üíº –í—ã –≥–æ—Ç–æ–≤—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º!{Colors.END}")
            print(f"{Colors.YELLOW}üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: hl mode professional{Colors.END}")
        
        print("="*50)
    
    config["level"] = level
    return config

def first_run():
    print("="*60)
    print(f"{Colors.BOLD}üöÄ HACKLAB MANAGER v2.0{Colors.END}")
    print("="*60)
    print()
    print(f"{Colors.BOLD}–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å:{Colors.END}")
    print()
    print(f"{Colors.GREEN}[1] üéì –ù–û–í–ò–ß–û–ö{Colors.END}")
    print("    ‚Ä¢ –ü–æ—à–∞–≥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ (15 —É—Ä–æ–∫–æ–≤)")
    print("    ‚Ä¢ 10 —É—Ä–æ–≤–Ω–µ–π —Å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤")
    print("    ‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É—á–µ–±–Ω—ã–µ —Ü–µ–ª–∏")
    print("    ‚Ä¢ XP —Å–∏—Å—Ç–µ–º–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è")
    print()
    print(f"{Colors.RED}[2] üî• –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ{Colors.END}")
    print("    ‚Ä¢ –í—Å–µ 12+ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å—Ä–∞–∑—É")
    print("    ‚Ä¢ –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ü–µ–ª—è–º")
    print("    ‚Ä¢ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏")
    print("    ‚Ä¢ –î–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–µ–Ω—Ç–µ—Å—Ç–µ—Ä–æ–≤")
    print()
    
    while True:
        choice = input(f"{Colors.YELLOW}–í–∞—à –≤—ã–±–æ—Ä (1 –∏–ª–∏ 2): {Colors.END}").strip()
        if choice == "1":
            config = {
                "mode": "beginner",
                "level": 1,
                "xp": 0,
                "unlocked_tools": ["network_info", "port_check"],
                "first_run": False,
                "created": datetime.now().isoformat()
            }
            save_config(config)
            print(f"{Colors.GREEN}‚úÖ –†–µ–∂–∏–º '–ù–æ–≤–∏—á–æ–∫' –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!{Colors.END}")
            break
        elif choice == "2":
            config = {
                "mode": "professional",
                "level": 10,
                "xp": 5000,
                "unlocked_tools": [
                    "network_info", "port_check", "web_scanner", 
                    "ssl_checker", "whois_checker", "dir_buster",
                    "subdomain_scanner", "cve_lookup", "hash_cracker",
                    "sql_tester", "xss_scanner", "api_fuzzer"
                ],
                "first_run": False,
                "created": datetime.now().isoformat()
            }
            save_config(config)
            print(f"{Colors.RED}üî• –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!{Colors.END}")
            print(f"{Colors.GREEN}–í—Å–µ 12 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã!{Colors.END}")
            break
        else:
            print(f"{Colors.RED}‚ùå –í–≤–µ–¥–∏—Ç–µ 1 –∏–ª–∏ 2{Colors.END}")

def show_welcome():
    config = load_config()
    mode = config.get("mode", "beginner")
    level = config.get("level", 1)
    xp = config.get("xp", 0)
    
    print("="*60)
    print(f"{Colors.BOLD}üöÄ HACKLAB MANAGER v2.0{Colors.END}")
    print("="*60)
    
    mode_display = f"{Colors.GREEN}–ù–û–í–ò–ß–û–ö{Colors.END}" if mode == "beginner" else f"{Colors.RED}–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ{Colors.END}"
    
    print(f"üë§ –†–µ–∂–∏–º: {mode_display}")
    print(f"üéÆ –£—Ä–æ–≤–µ–Ω—å: {level}")
    print(f"‚≠ê XP: {xp}")
    print(f"üõ†Ô∏è  –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: {len(config.get('unlocked_tools', []))}/12")
    print("="*60)
    print()
    print(f"{Colors.BOLD}üìã –û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´:{Colors.END}")
    print(f"  {Colors.CYAN}hl scan <target>{Colors.END}     - –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–∏")
    print(f"  {Colors.CYAN}hl dashboard{Colors.END}        - –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å")
    print(f"  {Colors.CYAN}hl tools{Colors.END}            - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã")
    print(f"  {Colors.CYAN}hl mode [beg/pro]{Colors.END}   - –°–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º")
    print(f"  {Colors.CYAN}hl learn{Colors.END}            - –û–±—É—á–µ–Ω–∏–µ")
    print(f"  {Colors.CYAN}hl analyze{Colors.END}          - –ê–Ω–∞–ª–∏–∑ —Ç–≤–æ–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞")
    print(f"  {Colors.CYAN}hl premium{Colors.END}          - Premium –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")
    print(f"  {Colors.CYAN}hl help{Colors.END}             - –°–ø—Ä–∞–≤–∫–∞")
    print()
    
    if mode == "beginner":
        print(f"{Colors.YELLOW}üéØ –¶–ï–õ–¨: –î–æ—Å—Ç–∏—á—å 10 —É—Ä–æ–≤–Ω—è –∏ —Å—Ç–∞—Ç—å –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–º!{Colors.END}")
        print(f"{Colors.YELLOW}üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: hl learn - –¥–ª—è –æ–±—É—á–µ–Ω–∏—è{Colors.END}")
    else:
        print(f"{Colors.RED}üî• –í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º - –Ω–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π!{Colors.END}")
        print(f"{Colors.RED}üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.{Colors.END}")
    
    print()
    print(f"{Colors.BOLD}–ü—Ä–∏–º–µ—Ä—ã:{Colors.END}")
    print(f"  hl scan scanme.nmap.org")
    print(f"  hl scan example.com --tool web_scanner")
    print(f"  hl mode professional")
    print("="*60)

def load_tool_module(tool_name):
    tool_path = os.path.join(TOOLS_DIR, f"{tool_name}.py")
    
    if not os.path.exists(tool_path):
        print(f"{Colors.RED}‚ùå –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç '{tool_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω{Colors.END}")
        print(f"{Colors.YELLOW}üí° –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: {tool_path}{Colors.END}")
        return None
    
    try:
        # –î–æ–±–∞–≤–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é tools –≤ sys.path
        sys.path.insert(0, TOOLS_DIR)
        
        # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å
        module_name = tool_name
        spec = importlib.util.spec_from_file_location(module_name, tool_path)
        module = importlib.util.module_from_spec(spec)
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º –º–æ–¥—É–ª—å
        spec.loader.exec_module(module)
        
        # –ò—â–µ–º –∫–ª–∞—Å—Å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è –∫–ª–∞—Å—Å–∞: network_info -> NetworkInfo
        class_name = ''.join(word.capitalize() for word in tool_name.split('_'))
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª–∞—Å—Å–∞
        if hasattr(module, class_name):
            tool_class = getattr(module, class_name)
            return tool_class()
        else:
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ª—é–±–æ–π –∫–ª–∞—Å—Å –≤ –º–æ–¥—É–ª–µ
            for attr_name in dir(module):
                attr = getattr(module, attr_name)
                if isinstance(attr, type) and attr.__module__ == module.__name__:
                    print(f"{Colors.YELLOW}‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω –∫–ª–∞—Å—Å: {attr_name} (–æ–∂–∏–¥–∞–ª—Å—è: {class_name}){Colors.END}")
                    return attr()
            
            print(f"{Colors.RED}‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –∫–ª–∞—Å—Å –≤ –º–æ–¥—É–ª–µ {tool_name}{Colors.END}")
            return None
            
    except Exception as e:
        print(f"{Colors.RED}‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ {tool_name}: {e}{Colors.END}")
        import traceback
        traceback.print_exc()
        return None

def cmd_scan(target, tool_name=None):
    config = load_config()
    mode = config.get("mode", "beginner")
    level = config.get("level", 1)
    unlocked_tools = config.get("unlocked_tools", [])
    
    # –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ü–µ–ª–∏ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤
    safe_targets = ["scanme.nmap.org", "example.com", "8.8.8.8", "1.1.1.1", "127.0.0.1"]
    
    if mode == "beginner" and target not in safe_targets:
        print(f"{Colors.RED}‚ùå –í —Ä–µ–∂–∏–º–µ –ù–æ–≤–∏—á–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ü–µ–ª–∏:{Colors.END}")
        for t in safe_targets:
            print(f"   ‚Ä¢ {t}")
        print()
        print(f"{Colors.YELLOW}üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: hl mode professional –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ü–µ–ª–µ–π{Colors.END}")
        return
    
    if tool_name:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        if tool_name not in unlocked_tools:
            print(f"{Colors.RED}‚ùå –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç '{tool_name}' –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω{Colors.END}")
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, –Ω–∞ –∫–∞–∫–æ–º —É—Ä–æ–≤–Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
            tool_levels = {
                "network_info": 1, "port_check": 1,
                "web_scanner": 2, "ssl_checker": 3,
                "whois_checker": 4, "dir_buster": 5,
                "subdomain_scanner": 6, "cve_lookup": 7,
                "hash_cracker": 8, "sql_tester": 9,
                "xss_scanner": 10, "api_fuzzer": 10
            }
            
            if tool_name in tool_levels:
                req_level = tool_levels[tool_name]
                print(f"   üìä –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ: {req_level}")
                print(f"   üìà –í–∞—à —É—Ä–æ–≤–µ–Ω—å: {level}")
            
            return
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
        print(f"\n{Colors.BLUE}üõ†Ô∏è  –ó–∞–ø—É—Å–∫–∞—é {tool_name.replace('_', ' ').title()}...{Colors.END}")
        tool = load_tool_module(tool_name)
        
        if tool:
            try:
                result = tool.run(target)
                
                # –î–æ–±–∞–≤–ª—è–µ–º XP
                if mode == "beginner":
                    old_level = config.get("level", 1)
                    config["xp"] = config.get("xp", 0) + 25
                    config = check_level_up(config)
                    save_config(config)
                    
                    print(f"\n{Colors.GREEN}‚ú® +25 XP –ø–æ–ª—É—á–µ–Ω–æ!{Colors.END}")
                    
                    if config.get("level", 1) > old_level:
                        print(f"{Colors.GREEN}üèÜ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω!{Colors.END}")
                
            except Exception as e:
                print(f"{Colors.RED}‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞: {e}{Colors.END}")
                import traceback
                traceback.print_exc()
        else:
            print(f"{Colors.RED}‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç {tool_name}{Colors.END}")
    
    else:
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        print(f"\n{Colors.BLUE}üéØ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–∏: {target}{Colors.END}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        print(f"{Colors.CYAN}üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:{Colors.END}")
        available = []
        for tool in unlocked_tools:
            tool_display = tool.replace("_", " ").title()
            print(f"   ‚Ä¢ {tool_display} ({tool})")
            available.append(tool)
        
        if not available:
            print(f"{Colors.YELLOW}‚ö†Ô∏è  –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤{Colors.END}")
            print(f"{Colors.YELLOW}üí° –ù–∞—á–Ω–∏—Ç–µ —Å: hl learn{Colors.END}")
            return
        
        # –°–ø—Ä–æ—Å–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        print(f"\n{Colors.YELLOW}–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è network_info):{Colors.END}")
        choice = input(f"{Colors.CYAN}> {Colors.END}").strip().lower()
        
        if choice == "":
            choice = "network_info"
        
        if choice in available:
            cmd_scan(target, choice)
        else:
            print(f"{Colors.RED}‚ùå –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω{Colors.END}")
            print(f"{Colors.YELLOW}üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: hl scan {target} --tool [–∏–º—è]{Colors.END}")

def cmd_dashboard():
    config = load_config()
    mode = config.get("mode", "beginner")
    level = config.get("level", 1)
    xp = config.get("xp", 0)
    unlocked = config.get("unlocked_tools", [])
    
    print("="*60)
    print(f"{Colors.BOLD}üìä –í–ê–® –ü–†–û–ì–†–ï–°–°{Colors.END}")
    print("="*60)
    
    mode_display = f"{Colors.GREEN}–ù–û–í–ò–ß–û–ö{Colors.END}" if mode == "beginner" else f"{Colors.RED}–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ{Colors.END}"
    
    print(f"üë§ –†–µ–∂–∏–º: {mode_display}")
    print(f"üéÆ –£—Ä–æ–≤–µ–Ω—å: {level}")
    print(f"‚≠ê XP: {xp}")
    print(f"üîì –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: {len(unlocked)}/12")
    
    if mode == "beginner":
        xp_needed = [0, 100, 250, 500, 850, 1300, 1850, 2500, 3250, 4100]
        
        if level < 10:
            current_xp = xp - xp_needed[level-1]
            needed_xp = xp_needed[level] - xp_needed[level-1]
            progress = (current_xp / needed_xp) * 100 if needed_xp > 0 else 100
            
            # –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            bar_length = 30
            filled = int(bar_length * current_xp / needed_xp)
            bar = f"{Colors.GREEN}{'‚ñà' * filled}{Colors.END}{'‚ñë' * (bar_length - filled)}"
            
            print(f"\nüìà –î–æ —É—Ä–æ–≤–Ω—è {level+1}:")
            print(f"   {bar} {progress:.1f}%")
            print(f"   {current_xp}/{needed_xp} XP")
        
        if level >= 10:
            print(f"\n{Colors.MAGENTA}üöÄ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ 10 —É—Ä–æ–≤–Ω—è!{Colors.END}")
            print(f"{Colors.YELLOW}üíº –í—ã –≥–æ—Ç–æ–≤—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º!{Colors.END}")
            print(f"{Colors.CYAN}üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: hl mode professional{Colors.END}")
    
    print("\n" + "="*60)

def cmd_tools():
    config = load_config()
    mode = config.get("mode", "beginner")
    level = config.get("level", 1)
    unlocked = config.get("unlocked_tools", [])
    
    all_tools = [
        ("network_info", "–°–µ—Ç–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", 1),
        ("port_check", "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤", 1),
        ("web_scanner", "–í–µ–±-—Å–∫–∞–Ω–µ—Ä", 2),
        ("ssl_checker", "–ü—Ä–æ–≤–µ—Ä–∫–∞ SSL", 3),
        ("whois_checker", "WHOIS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", 4),
        ("dir_buster", "–ü–æ–∏—Å–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π", 5),
        ("subdomain_scanner", "–ü–æ–∏—Å–∫ —Å—É–±–¥–æ–º–µ–Ω–æ–≤", 6),
        ("cve_lookup", "–ü–æ–∏—Å–∫ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π", 7),
        ("hash_cracker", "–í–∑–ª–æ–º —Ö–µ—à–µ–π", 8),
        ("sql_tester", "–¢–µ—Å—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π", 9),
        ("xss_scanner", "–ü–æ–∏—Å–∫ XSS", 10),
        ("api_fuzzer", "–§–∞–∑–∑–∏–Ω–≥ API", 10)
    ]
    
    print("="*60)
    print(f"{Colors.BOLD}üõ†Ô∏è  –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ HACKLAB MANAGER{Colors.END}")
    print("="*60)
    
    if mode == "professional":
        print(f"{Colors.RED}üî• –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô –†–ï–ñ–ò–ú{Colors.END}")
        print(f"{Colors.GREEN}‚úÖ –í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã!{Colors.END}\n")
        
        for tool_id, tool_name, req_level in all_tools:
            print(f"  ‚úÖ {tool_name} ({tool_id})")
    
    else:
        print(f"{Colors.GREEN}üéì –ù–û–í–ò–ß–û–ö (–£—Ä–æ–≤–µ–Ω—å {level}){Colors.END}\n")
        
        print(f"{Colors.CYAN}‚úÖ –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–´:{Colors.END}")
        for tool_id, tool_name, req_level in all_tools:
            if tool_id in unlocked:
                print(f"  ‚úÖ {tool_name}")
        
        if level < 10:
            print(f"\n{Colors.YELLOW}üîí –ë–£–î–£–¢ –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–´:{Colors.END}")
            for tool_id, tool_name, req_level in all_tools:
                if tool_id not in unlocked and req_level <= 10:
                    status = f"(–£—Ä–æ–≤–µ–Ω—å {req_level})"
                    if req_level <= level + 1:
                        print(f"  üîì {tool_name} {status}")
                    else:
                        print(f"  üîí {tool_name} {status}")
    
    print(f"\n{Colors.BOLD}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:{Colors.END}")
    print(f"  hl scan <—Ü–µ–ª—å> --tool <–∏–º—è_–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞>")
    print(f"  –ü—Ä–∏–º–µ—Ä: hl scan example.com --tool web_scanner")
    print("="*60)

def cmd_mode(new_mode):
    config = load_config()
    current_mode = config.get("mode", "beginner")
    
    if new_mode == "beg":
        new_mode = "beginner"
    elif new_mode == "pro":
        new_mode = "professional"
    
    if new_mode not in ["beginner", "professional"]:
        print(f"{Colors.RED}‚ùå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: hl mode beginner –∏–ª–∏ hl mode professional{Colors.END}")
        return
    
    if current_mode == new_mode:
        print(f"{Colors.YELLOW}‚ÑπÔ∏è  –í—ã —É–∂–µ –≤ —Ä–µ–∂–∏–º–µ {new_mode}{Colors.END}")
        return
    
    if current_mode == "beginner" and new_mode == "professional":
        level = config.get("level", 1)
        if level < 10:
            print(f"{Colors.RED}‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è 10 —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º{Colors.END}")
            print(f"   {Colors.YELLOW}–í–∞—à —É—Ä–æ–≤–µ–Ω—å: {level}{Colors.END}")
            print(f"   {Colors.CYAN}üí° –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –æ–±—É—á–µ–Ω–∏–µ: hl learn{Colors.END}")
            return
        
        print("="*60)
        print(f"{Colors.RED}üöÄ –ü–ï–†–ï–•–û–î –í –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô –†–ï–ñ–ò–ú{Colors.END}")
        print("="*60)
        print(f"{Colors.YELLOW}–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ 10 —É—Ä–æ–≤–Ω—è –∏ –≥–æ—Ç–æ–≤—ã –∫ –ü—Ä–æ-—Ä–µ–∂–∏–º—É!{Colors.END}")
        print()
        print(f"{Colors.RED}‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –í –ü—Ä–æ-—Ä–µ–∂–∏–º–µ:{Colors.END}")
        print(f"   ‚Ä¢ {Colors.RED}–ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ü–µ–ª—è–º{Colors.END}")
        print(f"   ‚Ä¢ {Colors.RED}–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫{Colors.END}")
        print(f"   ‚Ä¢ {Colors.RED}–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–∞—Å{Colors.END}")
        print()
        confirm = input(f"{Colors.YELLOW}–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥ (yes/no): {Colors.END}").strip().lower()
        
        if confirm not in ["yes", "y", "–¥–∞", "–¥"]:
            print(f"{Colors.YELLOW}‚ùå –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç–º–µ–Ω–µ–Ω{Colors.END}")
            return
        
        # –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        config["unlocked_tools"] = [
            "network_info", "port_check", "web_scanner", 
            "ssl_checker", "whois_checker", "dir_buster",
            "subdomain_scanner", "cve_lookup", "hash_cracker",
            "sql_tester", "xss_scanner", "api_fuzzer"
        ]
    
    config["mode"] = new_mode
    save_config(config)
    
    mode_display = f"{Colors.GREEN}–ù–û–í–ò–ß–û–ö{Colors.END}" if new_mode == "beginner" else f"{Colors.RED}–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ{Colors.END}"
    print(f"{Colors.GREEN}‚úÖ –†–µ–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω: {mode_display}{Colors.END}")

def cmd_learn():
    learn_script = os.path.join(BASE_DIR, "learn.py")
    if os.path.exists(learn_script):
        print(f"{Colors.BLUE}üìö –ó–∞–ø—É—Å–∫–∞—é —Å–∏—Å—Ç–µ–º—É –æ–±—É—á–µ–Ω–∏—è...{Colors.END}")
        subprocess.run(["python3", learn_script])
    else:
        print(f"{Colors.RED}‚ùå –§–∞–π–ª –æ–±—É—á–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω{Colors.END}")
        print(f"{Colors.YELLOW}–°–æ–∑–¥–∞–π—Ç–µ learn.py –≤ –ø–∞–ø–∫–µ hacklab_v2{Colors.END}")

def cmd_analyze():
    """–ê–Ω–∞–ª–∏–∑ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    print(f"{Colors.BLUE}üß† –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–≤–æ–π –ø–æ–¥—Ö–æ–¥...{Colors.END}")
    print(f"DEBUG: BASE_DIR = {BASE_DIR}")  # –î–æ–±–∞–≤–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É
    print(f"DEBUG: analyzer.py exists = {os.path.exists(os.path.join(BASE_DIR, 'core', 'analyzer.py'))}")  # –ò —ç—Ç—É
    # –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–∞–ø—Ä—è–º—É—é
    import sys
    sys.path.insert(0, BASE_DIR)
    from core.analyzer import ThinkingAnalyzer
    analyzer = ThinkingAnalyzer()
    analyzer.print_report()

def cmd_lab():
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è–º–∏"""
    if len(sys.argv) < 3:
        print(f"\n{Colors.BOLD}üìö –ö–û–ú–ê–ù–î–´ LAB:{Colors.END}")
        print(f"  {Colors.CYAN}hl lab list{Colors.END}          - –°–ø–∏—Å–æ–∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–π")
        print(f"  {Colors.CYAN}hl lab start <id>{Colors.END}    - –ù–∞—á–∞—Ç—å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é")
        print(f"  {Colors.CYAN}hl lab info <id>{Colors.END}     - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ lab")
        print(f"  {Colors.CYAN}hl lab progress <id>{Colors.END} - –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è")
        print(f"  {Colors.CYAN}hl lab finish <id>{Colors.END}   - –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å –æ—Ç—á–µ—Ç")
        return
    
    subcommand = sys.argv[2]
    
    if subcommand == "list":
        print(f"\n{Colors.BOLD}üìö –î–û–°–¢–£–ü–ù–´–ï –õ–ê–ë–û–†–ê–¢–û–†–ò–ò:{Colors.END}")
        print(f"  {Colors.GREEN}1. Web Pentest Basics{Colors.END}")
        print(f"     –¶–µ–ª—å: testfire.net")
        print(f"     –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: 7 –∏–∑ 12")
        print(f"     –°–ª–æ–∂–Ω–æ—Å—Ç—å: üü¢ –õ–µ–≥–∫–∞—è")
        print(f"     –°—Ç–∞—Ç—É—Å: {Colors.GREEN}–î–æ—Å—Ç—É–ø–Ω–∞{Colors.END}")
        
        print(f"\n  {Colors.YELLOW}2. Network Reconnaissance{Colors.END}")
        print(f"     –¶–µ–ª—å: scanme.nmap.org")
        print(f"     –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: 8 –∏–∑ 12")
        print(f"     –°–ª–æ–∂–Ω–æ—Å—Ç—å: üü° –°—Ä–µ–¥–Ω—è—è")
        print(f"     –°—Ç–∞—Ç—É—Å: {Colors.GREEN}–î–æ—Å—Ç—É–ø–Ω–∞{Colors.END}")
        
        print(f"\n  {Colors.RED}3. Full Penetration Test{Colors.END}")
        print(f"     –¶–µ–ª—å: multiple targets")
        print(f"     –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: –≤—Å–µ 12")
        print(f"     –°–ª–æ–∂–Ω–æ—Å—Ç—å: üî¥ –°–ª–æ–∂–Ω–∞—è")
        print(f"     –°—Ç–∞—Ç—É—Å: {Colors.YELLOW}Premium{Colors.END}")
        
    elif subcommand == "start":
        if len(sys.argv) < 4:
            print(f"{Colors.RED}‚ùå –£–∫–∞–∂–∏—Ç–µ ID –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏{Colors.END}")
            print(f"{Colors.YELLOW}–ü—Ä–∏–º–µ—Ä: hl lab start 1{Colors.END}")
            return
        
        lab_id = sys.argv[3]
        
        if lab_id == "1":
            print(f"\n{Colors.GREEN}üöÄ –ù–ê–ß–ò–ù–ê–ï–ú LAB 1: Web Pentest Basics{Colors.END}")
            print("="*50)
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
            desc_path = os.path.join(BASE_DIR, "labs", "lab1_web", "description.md")
            if os.path.exists(desc_path):
                with open(desc_path, 'r') as f:
                    print(f.read())
            
            print(f"\n{Colors.YELLOW}üí° –î–ª—è –Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–π:{Colors.END}")
            print(f"  hl tool whois_checker testfire.net")
            print(f"  –∏–ª–∏")
            print(f"  python3 tools/whois_checker.py testfire.net")
            
            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º lab_id –¥–ª—è –ª–æ–≥–≥–µ—Ä–∞
            try:
                from core.action_logger import logger
                logger.set_context(lab_id=int(lab_id))
                print(f"\n{Colors.GREEN}‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: Lab {lab_id}{Colors.END}")
            except:
                print(f"\n{Colors.YELLOW}‚ö†Ô∏è  –õ–æ–≥–≥–µ—Ä –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω{Colors.END}")
                
        else:
            print(f"{Colors.RED}‚ùå Lab {lab_id} –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–∞{Colors.END}")
    
    elif subcommand == "info":
        if len(sys.argv) < 4:
            print(f"{Colors.RED}‚ùå –£–∫–∞–∂–∏—Ç–µ ID –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏{Colors.END}")
            return
        
        lab_id = sys.argv[3]
        print(f"{Colors.BLUE}üìñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Lab {lab_id}{Colors.END}")
        
    else:
        print(f"{Colors.RED}‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: {subcommand}{Colors.END}")

def cmd_premium():
    print("="*60)
    print(f"{Colors.BOLD}üí∞ HACKLAB MANAGER PREMIUM{Colors.END}")
    print("="*60)
    print(f"{Colors.MAGENTA}–î–æ—Å—Ç—É–ø–Ω–æ –∑–∞ $15/–º–µ—Å—è—Ü –∏–ª–∏ $150/–≥–æ–¥{Colors.END}")
    print()
    print(f"{Colors.GREEN}üî• PREMIUM –§–ò–ß–ò:{Colors.END}")
    print(f"  ‚Ä¢ HTB API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–∞–≤—Ç–æ-–∏–º–ø–æ—Ä—Ç –º–∞—à–∏–Ω)")
    print(f"  ‚Ä¢ Shodan –ø–æ–∏—Å–∫ (–ø–æ–∏—Å–∫ —É—è–∑–≤–∏–º—ã—Ö —Å–∏—Å—Ç–µ–º)")
    print(f"  ‚Ä¢ PDF –æ—Ç—á–µ—Ç—ã (–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤)")
    print(f"  ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (—Å–∫—Ä–∏–ø—Ç—ã –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)")
    print(f"  ‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞")
    print()
    print(f"{Colors.CYAN}üí° –ë–ò–ó–ù–ï–°-–ú–û–î–ï–õ–¨:{Colors.END}")
    print(f"  –ë–µ—Å–ø–ª–∞—Ç–Ω–æ: –ù–æ–≤–∏—á–æ–∫ —Ä–µ–∂–∏–º (10 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –æ–±—É—á–µ–Ω–∏–µ)")
    print(f"  Premium: $15/–º–µ—Å—è—Ü (20+ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, API, –∞–≤—Ç–æ-–æ—Ç—á–µ—Ç—ã)")
    print(f"  Team: $49/–º–µ—Å—è—Ü (–¥–æ 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏—è)")
    print()
    print(f"{Colors.YELLOW}üéØ –¶–ï–õ–¨: 100 Premium –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π = $1500/–º–µ—Å—è—Ü{Colors.END}")
    print()
    print(f"{Colors.BOLD}üí≥ –î–ª—è –ø–æ–∫—É–ø–∫–∏ –ø–æ—Å–µ—Ç–∏—Ç–µ:{Colors.END}")
    print(f"   https://hacklab-manager.com/premium")
    print(f"   –ü—Ä–æ–º–æ–∫–æ–¥: {Colors.GREEN}TRYHACKLAB{Colors.END}")
    print("="*60)

def main():
    # –û–¢–õ–ê–î–ö–ê: –ø–æ–∫–∞–∂–µ–º —á—Ç–æ –ø—Ä–∏—à–ª–æ
    print(f"DEBUG: sys.argv = {sys.argv}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
    if not os.path.exists(CONFIG_FILE):
        first_run()
        show_welcome()
        return

def cmd_help():
    show_welcome()

def main():
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
    if not os.path.exists(CONFIG_FILE):
        first_run()
        show_welcome()
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã
    if len(sys.argv) < 2:
        show_welcome()
        return
    
    command = sys.argv[1]
    
    if command == "scan":
        if len(sys.argv) < 3:
            print(f"{Colors.RED}‚ùå –£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è{Colors.END}")
            print(f"{Colors.YELLOW}–ü—Ä–∏–º–µ—Ä: hl scan scanme.nmap.org{Colors.END}")
            return
        
        target = sys.argv[2]
        tool_name = None
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ --tool
        if "--tool" in sys.argv:
            tool_index = sys.argv.index("--tool")
            if tool_index + 1 < len(sys.argv):
                tool_name = sys.argv[tool_index + 1]
        
        cmd_scan(target, tool_name)
    
    elif command == "dashboard":
        cmd_dashboard()
    
    elif command == "mode":
        if len(sys.argv) < 3:
            print(f"{Colors.RED}‚ùå –£–∫–∞–∂–∏—Ç–µ —Ä–µ–∂–∏–º: beginner –∏–ª–∏ professional{Colors.END}")
            return
        cmd_mode(sys.argv[2])
    
    elif command == "tools":
        cmd_tools()
    
    elif command == "level":
        config = load_config()
        level = config.get("level", 1)
        xp = config.get("xp", 0)
        print(f"{Colors.CYAN}üéÆ –í–∞—à —É—Ä–æ–≤–µ–Ω—å: {level}{Colors.END}")
        print(f"{Colors.YELLOW}‚≠ê XP: {xp}{Colors.END}")
        
        if config.get("mode") == "beginner" and level < 10:
            xp_needed = [0, 100, 250, 500, 850, 1300, 1850, 2500, 3250, 4100]
            needed = xp_needed[level] - xp
            print(f"{Colors.GREEN}üìà –î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –Ω—É–∂–Ω–æ: {needed} XP{Colors.END}")
    
    elif command == "learn":
        cmd_learn()
    
    elif command == "analyze":
        cmd_analyze()
    
    elif command == "lab":
        cmd_lab()

    elif command == "premium":
        cmd_premium()
    
    elif command == "help":
        cmd_help()
    
    else:
        print(f"{Colors.RED}‚ùå –ö–æ–º–∞–Ω–¥–∞ '{command}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞{Colors.END}")
        cmd_help()

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print(f"\n{Colors.YELLOW}üëã –í—ã—Ö–æ–¥ –∏–∑ HackLab Manager{Colors.END}")
        sys.exit(0)
    except Exception as e:
        print(f"{Colors.RED}‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}{Colors.END}")
        import traceback
        traceback.print_exc()
        sys.exit(1)
